{% extends 'inicio/base.html' %}
{% block contenido %}
<div class="off-canvas-content" data-off-canvas-content>
 <div class="row titulo large-8 large-offset-2 medium-8 medium-offset-2 small-12">
   <form class="" action="#" method="post">{% csrf_token %}
      <h3>Agregar Codigo de barras(SKU)</h3>
      {% if form.errors %}
        <h5 class="error">Ha ocurrido un error</h5>
        {% for field in form %}
          {% for error in field.errors %}
            <h5 class="error">{{error|escape}}</h5>
          {% endfor %}
        {% endfor %}
      {% else %}
        {% if detalle %}
          {% if detalle != "0" %}
          <h5 class="error">
            {{detalle}}
          </h5>
          {% endif %}
        {% endif %}
      {% endif %}
      <label class="" for="id_nombreproducto">Seleccione Producto: (Requerido)</label>
      {{form.producto}}
      <div class="input-group">
        <a href="#" class="botonopenmodal input-group-button" id="abrirmodal" data-open="exampleModal1"><i class="material-icons">search</i></a>
        <input type="text" class=" input-group-field" readonly id="id_nombreproducto" name="" value="">
        <div hidden id="errorproducto" class="error">
          Debe seleccionar una Categoria.
        </div>
      </div>
      <label for="id_imagen">Imagen: (Requerido)</label>
      <div hidden id="errorimagen" class="error">
        Debe seleccionar Ingresar una url.
      </div>
      {{form.imagen}}
      <label for="id_genero">Genero: (Requerido)</label>
      <div hidden id="errorgenero" class="error">
        Debe seleccionar Ingresar un stock minimo.
      </div>
      {{form.genero}}
      <label for="id_genero">Descripcion: (Requerido)</label>
      <div hidden id="errordescripcion" class="error">
        Debe seleccionar Ingresar una descripcion.
      </div>
      {{form.descripcion}}
      <button type="submit" class="button boton1" name="entrar">Guardar</button>
   </form>
 </div>
 <!--MODAL PARA PRODUCTOS-->
   <div class="reveal titulo" id="exampleModal1" data-reveal>
    <h3>Seleccionar Producto</h3>
    <div class="input-group input-group-rounded columns large-6 medium-4">
      <span class="input-group-label"><i class="material-icons">search</i></span>
      <input type="text" id="texto" name="buscador" class="buscador input-group-field" placeholder="Buscar Producto" id="buscador">
    </div>
      <table id="tabla">
        <thead>
          <tr>
            <th>Categoria</th>
            <th>Marca</th>
            <th>Modelo</th>
            <th>Seleccionar</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    <button class="close-button" data-close aria-label="Close modal" type="button">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
<!--MODAL PARA PRODUCTOS-->
</div>
{% endblock contenido %}
{%block script%}
$( document ).ready(function() {
  $("#abrirmodal").focus();
});

$('#texto').change(function(){
  a = $("#texto").val().length;
  if(a>1){
    $("#tabla tbody").remove();
    texto = $("#texto").val();
    nuevafila = "<tr>"
    $.ajax({
      data: {'term':texto},
      url: "/productos/buscar-ajax",
      type: "get",
      success: function(data){
        for(var i = 0; i<data.length; i++){
          categoria = data[i].categoria.replace(/\s+/g, '-');
          modelo = data[i].modelo.replace(/\s+/g, '-');
          marca = data[i].marca.replace(/\s+/g, '-');
          nombrecompleto = categoria + '-' + marca + '-' + modelo;
          console.log(nombrecompleto);
          nuevafila +="<td>" + data[i].categoria + "</td>" +
                      "<td>" + data[i].marca + "</td>" +
                      "<td>" + data[i].modelo + "</td>" +
                      "<td><a href=javascript:seleccionar("+ data[i].pk + ",'" + nombrecompleto + "');><i class=material-icons>thumb_up</i></a></td></tr>";
       }
       $("#tabla").append(nuevafila);
      }
    });
  }
});
function seleccionar(id, modelo){
  $("#id_producto").val(id);
  $("#id_nombreproducto").val(modelo);
  $("#exampleModal1").foundation('close');
  $("#id_imagen").focus();
}
{% endblock %}
